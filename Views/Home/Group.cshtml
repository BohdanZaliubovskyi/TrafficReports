@model TestTrafficReports.Models.NodesViewModel

@{
    ViewBag.Title = "Группировка";
}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    @Scripts.Render("~/scripts/jquery-3.3.1.js")
    <script type="text/javascript">
        function toggle_show(name) {
            var myArray = document.getElementsByClassName(name);
            for (var i = 0; i < 3; i++) {
                    myArray[i].style.display = myArray[i].style.display == 'none' ? '' : 'none';
                }
            }
        

        /*
         *  //document.getElementsByClassName(id).style.display = document.getElementsByClassName(id).style.display == 'none' ? 'block' : 'none';
            //document.getElementsByClassName(id).each(function (i, elem) {
            //        elem.style.display == 'none' ? 'block' : 'none';
         *  document.getElementById(id).style.display = document.getElementById(id).style.display == 'none' ? 'block' : 'none';
         *  
         *  
         *  document.getElementsByClassName(id).each(function (i, elem) {
                elem.style.display = elem.style.display == 'none' ? 'block' : 'none';
            });
         * 
         * 
         * var a = [17, 22, 13];

        a.forEach(function (el, idx, a) {
            document.write('a[' + idx + '] = ' + el + ' в [' + a + '] <br>');
        });


        var arr = [17, 22, 13];

        function foo(value) {
            var sum = value. * this;
            return document.write(sum + "<br>");
        }
        arr.forEach(foo, 5);*/

        /*if (!document.getElementById("#content").contains("ul"))
            $("body").append('<li><a href="/user/messages"><span class="tab">Message Center</span></a></li>');

        document.getElementById("#content").append('<ul><li><a href="/user/messages"><span class="tab">Message Center</span></a></li></ul>');

        var o = document.getElementById("#content");
        o.appendChild(document.createElement('br'));*/

            /*document.getElementById("#content").append('<li><a href="/user/messages"><span class="tab">Message Center</span></a></li>');*/


        /*$("body").append('<li><a href="/user/messages"><span class="tab">Message Center</span></a></li>');*/

    </script>

</head>
<body>
    @*@var rootElements = Model.Nodes.Where(n=>n.ParentId == -1).ToList()*@
    @*if(rootElements != null && rootElements.Count > 0)
        {*@

    @*<ul>


        @foreach (var parentNode in Model.Nodes)
        {

            //var childElements = Model.Nodes.Where(c=>c.ParentId == parentNode.CurrentId);
            if (parentNode.ParentId == -1)
            {
                <li onClick="toggle_show('@parentNode.CurrentId')">
                    <p>@Model.Cities[parentNode.CurrentId].Name @parentNode.PlanCarriages  @parentNode.FactCarriages</p>
                    <ul class="@parentNode.CurrentId" style="display: none">
                        @foreach (var childNode in Model.Nodes)
                        {
                            if (childNode.ParentId == parentNode.CurrentId)
                            {
                                <li><p>@Model.Cities[childNode.CurrentId].Name @childNode.PlanCarriages  @childNode.FactCarriages</p></li>
                            }
                        }
                    </ul>
                </li>
            }
        }
    </ul>*@

    <table border="1">
        <tr style="color:green">
            <td>Город</td>
            <td>Плановые перевозки</td>
            <td>Фактические перевозки</td>
        </tr>

        @*@var rootElements = Model.Nodes.Where(n=>n.ParentId == -1).ToList()*@
        @*if(rootElements != null && rootElements.Count > 0)
            {*@
        <br/>
        @foreach (var parentNode in Model.Nodes)
        {
            //var childElements = Model.Nodes.Where(c=>c.ParentId == parentNode.CurrentId); // так почему-то не получилось
            if (parentNode.ParentId == -1)
            {                
                <tr onClick="toggle_show('@parentNode.CurrentId')" style="color:blue">
                    <td >@Model.Cities[parentNode.CurrentId].Name</td>
                    <td>@parentNode.PlanCarriages</td>
                    <td>@parentNode.FactCarriages</td>
                </tr>               
                foreach(var childNode in Model.Nodes)
                {
                    if (childNode.ParentId == parentNode.CurrentId)
                    {                        
                <tr class="@parentNode.CurrentId" style="display: none">
                    @*<td class="@parentNode.CurrentId" style="display: none">@Model.Cities[childNode.CurrentId].Name</td>
                    <td class="@parentNode.CurrentId" style="display: none">@childNode.PlanCarriages</td>
                    <td class="@parentNode.CurrentId" style="display: none">@childNode.FactCarriages</td>*@
                    <td>@Model.Cities[childNode.CurrentId].Name</td>
                    <td>@childNode.PlanCarriages</td>
                    <td>@childNode.FactCarriages</td>
                </tr>                        
                    }
                }
            }
        }

    </table>

    @*<div id="content">dfvdvdv</div>

    <ul>
        <li>Название 1</li>
        <li onClick="toggle_show('bbb')">
            Название 2
            <ul id="bla-bla2" class="bbb" style="display: none">
                <li>Бла Бла Бла</li>
                <li>Бла Бла Бла</li>
                <li>Бла Бла Бла</li>
            </ul>
        </li>
        <li>Название 3</li>
    </ul>*@


</body>
</html>
